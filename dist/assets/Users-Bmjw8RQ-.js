import{u as M,e as q,b as U,j as e,a as c}from"./index-Cf1eI5hH.js";import{r as m}from"./vendor-CPt1K6Li.js";import{u as y}from"./useMutation-DI0lfsM0.js";import{Q as L,U as w,m as j,z as k,Y as Q,X as N,D as K,V as l}from"./ui-Rj_xN0Fu.js";function I(){const{isDarkMode:r}=M(),x=q(),[v,n]=m.useState(!1),[d,u]=m.useState(null),[a,h]=m.useState({username:"",email:"",password:"",role:"viewer"}),[$,p]=m.useState(null),{data:g=[],isLoading:z}=U({queryKey:["users"],queryFn:async()=>{try{return(await c.get("/api/admin/users")).data}catch(t){return console.error("Fehler beim Abrufen der Benutzer:",t),[]}}}),B=y({mutationFn:async t=>(await c.post("/api/admin/users",t)).data,onSuccess:()=>{x.invalidateQueries({queryKey:["users"]}),l.success("Benutzer erfolgreich erstellt"),b(),n(!1)},onError:t=>{console.error("Fehler beim Erstellen des Benutzers:",t),l.error("Fehler beim Erstellen des Benutzers")}}),C=y({mutationFn:async t=>{const{id:s,...i}=t;return(await c.put(`/api/admin/users/${s}`,i)).data},onSuccess:()=>{x.invalidateQueries({queryKey:["users"]}),l.success("Benutzer erfolgreich aktualisiert"),b(),n(!1),u(null)},onError:t=>{console.error("Fehler beim Aktualisieren des Benutzers:",t),l.error("Fehler beim Aktualisieren des Benutzers")}}),F=y({mutationFn:async t=>(await c.delete(`/api/admin/users/${t}`),t),onSuccess:t=>{x.invalidateQueries({queryKey:["users"]}),l.success("Benutzer erfolgreich gelöscht"),p(null)},onError:t=>{console.error("Fehler beim Löschen des Benutzers:",t),l.error("Fehler beim Löschen des Benutzers")}}),o=t=>{const{name:s,value:i}=t.target;h(f=>({...f,[s]:i}))},A=t=>{if(t.preventDefault(),d){const s={id:d.id,username:a.username,email:a.email,role:a.role};a.password&&(s.password=a.password),C.mutate(s)}else B.mutate(a)},D=t=>{u(t),h({username:t.username,email:t.email,password:"",role:t.role}),n(!0)},E=t=>{const s=g.find(i=>i.id===t);if(s!=null&&s.isMainAdmin){l.error("Der Hauptadmin-Account kann nicht gelöscht werden");return}F.mutate(t)},b=()=>{h({username:"",email:"",password:"",role:"viewer"}),u(null)},S=t=>{switch(t){case"admin":return r?"bg-red-500/20 text-red-400 border-red-500/30":"bg-red-100 text-red-700 border-red-200";case"editor":return r?"bg-blue-500/20 text-blue-400 border-blue-500/30":"bg-blue-100 text-blue-700 border-blue-200";default:return r?"bg-gray-500/20 text-gray-400 border-gray-500/30":"bg-gray-100 text-gray-700 border-gray-200"}};return e.jsxs("div",{className:`p-6 ${r?"bg-dark-950":"bg-gray-100"} min-h-screen`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:`text-3xl font-bold ${r?"text-cyto-400":"text-cyto-600"}`,children:"Benutzerverwaltung"}),e.jsx("p",{className:`mt-1 ${r?"text-dark-300":"text-gray-600"}`,children:"Verwalte Benutzerkonten und Berechtigungen"})]}),e.jsxs("button",{onClick:()=>{b(),n(!0)},className:`inline-flex items-center px-4 py-2 rounded-lg ${r?"bg-cyto-600 text-white hover:bg-cyto-500":"bg-cyto-500 text-white hover:bg-cyto-600"} transition-colors duration-300`,children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Neuer Benutzer"]})]}),e.jsx("div",{className:`rounded-xl border ${r?"bg-dark-900/70 border-dark-800":"bg-white border-gray-200"} overflow-hidden shadow-sm`,children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:`${r?"bg-dark-800":"bg-gray-50"}`,children:e.jsxs("tr",{children:[e.jsx("th",{className:`px-6 py-3 text-left text-xs font-medium ${r?"text-dark-300":"text-gray-500"} uppercase tracking-wider`,children:"Benutzer"}),e.jsx("th",{className:`px-6 py-3 text-left text-xs font-medium ${r?"text-dark-300":"text-gray-500"} uppercase tracking-wider`,children:"Rolle"}),e.jsx("th",{className:`px-6 py-3 text-left text-xs font-medium ${r?"text-dark-300":"text-gray-500"} uppercase tracking-wider`,children:"Erstellt am"}),e.jsx("th",{className:`px-6 py-3 text-left text-xs font-medium ${r?"text-dark-300":"text-gray-500"} uppercase tracking-wider`,children:"Letzter Login"}),e.jsx("th",{className:`px-6 py-3 text-right text-xs font-medium ${r?"text-dark-300":"text-gray-500"} uppercase tracking-wider`,children:"Aktionen"})]})}),e.jsx("tbody",{className:`divide-y ${r?"divide-dark-800":"divide-gray-200"}`,children:z?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:`px-6 py-4 text-center ${r?"text-dark-300":"text-gray-500"}`,children:"Benutzer werden geladen..."})}):g.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:`px-6 py-4 text-center ${r?"text-dark-300":"text-gray-500"}`,children:"Keine Benutzer gefunden"})}):g.map(t=>e.jsxs("tr",{className:`${r?"hover:bg-dark-800/50":"hover:bg-gray-50"} transition-colors duration-150`,children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`flex-shrink-0 h-10 w-10 rounded-full flex items-center justify-center ${r?"bg-dark-800":"bg-gray-100"}`,children:e.jsx(w,{className:`h-5 w-5 ${r?"text-dark-300":"text-gray-500"}`})}),e.jsxs("div",{className:"ml-4",children:[e.jsxs("div",{className:`font-medium ${r?"text-white":"text-gray-900"}`,children:[t.username,t.isMainAdmin&&e.jsxs("span",{className:"ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400",children:[e.jsx(j,{className:"w-3 h-3 mr-1"}),"Hauptadmin"]})]}),e.jsx("div",{className:`text-sm ${r?"text-dark-400":"text-gray-500"}`,children:t.email})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${S(t.role)}`,children:[t.role==="admin"&&e.jsx(j,{className:"w-3 h-3 mr-1"}),t.role==="editor"&&e.jsx(k,{className:"w-3 h-3 mr-1"}),t.role==="viewer"&&e.jsx(w,{className:"w-3 h-3 mr-1"}),t.role.charAt(0).toUpperCase()+t.role.slice(1)]})}),e.jsx("td",{className:`px-6 py-4 whitespace-nowrap text-sm ${r?"text-dark-300":"text-gray-500"}`,children:new Date(t.createdAt).toLocaleDateString("de-DE")}),e.jsx("td",{className:`px-6 py-4 whitespace-nowrap text-sm ${r?"text-dark-300":"text-gray-500"}`,children:t.lastLogin?new Date(t.lastLogin).toLocaleDateString("de-DE"):"Nie"}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[e.jsx("button",{onClick:()=>D(t),className:"text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300 mr-3",children:e.jsx(k,{className:"w-4 h-4"})}),$===t.id?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>E(t.id),className:"text-green-600 hover:text-green-900 dark:text-green-400 dark:hover:text-green-300 mr-2",children:e.jsx(Q,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>p(null),className:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300",children:e.jsx(N,{className:"w-4 h-4"})})]}):e.jsx("button",{onClick:()=>p(t.id),className:`text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300 ${t.isMainAdmin?"opacity-50 cursor-not-allowed":""}`,disabled:t.isMainAdmin,title:t.isMainAdmin?"Hauptadmin kann nicht gelöscht werden":"Benutzer löschen",children:e.jsx(K,{className:"w-4 h-4"})})]})]},t.id))})]})})}),v&&e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 transition-opacity",onClick:()=>n(!1)}),e.jsxs("div",{className:`relative z-10 w-full max-w-md p-6 rounded-lg shadow-xl ${r?"bg-dark-900 border border-dark-700":"bg-white"}`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:`text-xl font-semibold ${r?"text-white":"text-gray-900"}`,children:d?"Benutzer bearbeiten":"Neuen Benutzer erstellen"}),e.jsx("button",{onClick:()=>n(!1),className:`${r?"text-dark-300 hover:text-white":"text-gray-500 hover:text-gray-700"}`,children:e.jsx(N,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:A,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"username",className:`block text-sm font-medium ${r?"text-dark-200":"text-gray-700"} mb-1`,children:"Benutzername"}),e.jsx("input",{type:"text",id:"username",name:"username",value:a.username,onChange:o,required:!0,className:`block w-full rounded-md shadow-sm ${r?"bg-dark-800 border-dark-700 text-white focus:border-cyto-500 focus:ring-cyto-500":"border-gray-300 focus:border-cyto-500 focus:ring-cyto-500"} sm:text-sm`})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:`block text-sm font-medium ${r?"text-dark-200":"text-gray-700"} mb-1`,children:"E-Mail"}),e.jsx("input",{type:"email",id:"email",name:"email",value:a.email,onChange:o,required:!0,className:`block w-full rounded-md shadow-sm ${r?"bg-dark-800 border-dark-700 text-white focus:border-cyto-500 focus:ring-cyto-500":"border-gray-300 focus:border-cyto-500 focus:ring-cyto-500"} sm:text-sm`})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:`block text-sm font-medium ${r?"text-dark-200":"text-gray-700"} mb-1`,children:d?"Passwort (leer lassen, um nicht zu ändern)":"Passwort"}),e.jsx("input",{type:"password",id:"password",name:"password",value:a.password,onChange:o,required:!d,className:`block w-full rounded-md shadow-sm ${r?"bg-dark-800 border-dark-700 text-white focus:border-cyto-500 focus:ring-cyto-500":"border-gray-300 focus:border-cyto-500 focus:ring-cyto-500"} sm:text-sm`})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"role",className:`block text-sm font-medium ${r?"text-dark-200":"text-gray-700"} mb-1`,children:"Rolle"}),e.jsxs("select",{id:"role",name:"role",value:a.role,onChange:o,className:`block w-full rounded-md shadow-sm ${r?"bg-dark-800 border-dark-700 text-white focus:border-cyto-500 focus:ring-cyto-500":"border-gray-300 focus:border-cyto-500 focus:ring-cyto-500"} sm:text-sm`,children:[e.jsx("option",{value:"viewer",children:"Viewer"}),e.jsx("option",{value:"editor",children:"Editor"}),e.jsx("option",{value:"admin",children:"Admin"})]})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>n(!1),className:`px-4 py-2 rounded-md text-sm font-medium ${r?"bg-dark-800 text-dark-200 hover:bg-dark-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Abbrechen"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded-md text-sm font-medium bg-cyto-600 text-white hover:bg-cyto-700",children:d?"Aktualisieren":"Erstellen"})]})]})]})]})})]})}export{I as Users};
